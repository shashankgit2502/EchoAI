{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "AgentSystemDefinition",
  "description": "Complete agent system design generated by the Designer LLM",
  "type": "object",
  "required": [
    "system_name",
    "description",
    "domain",
    "agents",
    "tools",
    "workflows",
    "communication_pattern"
  ],
  "properties": {
    "system_name": {
      "type": "string",
      "description": "Unique name for this agent system"
    },
    "description": {
      "type": "string",
      "description": "Human-readable description of what this system does"
    },
    "domain": {
      "type": "string",
      "description": "Primary domain (e.g., inventory, sales, customer_service)"
    },
    "agents": {
      "type": "array",
      "description": "List of agent specifications",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/Agent"
      }
    },
    "tools": {
      "type": "array",
      "description": "List of tool specifications required by agents",
      "items": {
        "$ref": "#/definitions/Tool"
      }
    },
    "workflows": {
      "type": "array",
      "description": "List of workflow definitions",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/Workflow"
      }
    },
    "communication_pattern": {
      "type": "string",
      "enum": ["sequential", "parallel", "hierarchical", "conditional", "graph"],
      "description": "Overall communication pattern for the system"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "complexity_score": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10
        },
        "estimated_agents": {
          "type": "integer"
        }
      }
    }
  },
  "definitions": {
    "Agent": {
      "type": "object",
      "required": ["id", "name", "role", "responsibilities", "system_prompt", "llm_config"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9_]*$",
          "description": "Unique agent identifier (lowercase, underscore-separated)"
        },
        "name": {
          "type": "string",
          "description": "Human-readable agent name"
        },
        "role": {
          "type": "string",
          "description": "Concise role description"
        },
        "responsibilities": {
          "type": "array",
          "description": "List of specific tasks this agent handles",
          "minItems": 1,
          "maxItems": 10,
          "items": {
            "type": "string"
          }
        },
        "system_prompt": {
          "type": "string",
          "description": "Detailed instructions for the agent's LLM",
          "minLength": 50
        },
        "tools": {
          "type": "array",
          "description": "List of tool names this agent can use",
          "items": {
            "type": "string"
          }
        },
        "llm_config": {
          "type": "object",
          "required": ["model", "temperature"],
          "properties": {
            "model": {
              "type": "string",
              "description": "LLM model identifier (e.g., gpt-4, claude-sonnet-4-5)"
            },
            "temperature": {
              "type": "number",
              "minimum": 0,
              "maximum": 2
            },
            "max_tokens": {
              "type": "integer",
              "minimum": 100,
              "maximum": 128000,
              "default": 2000
            },
            "top_p": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "default": 1.0
            }
          }
        },
        "input_schema": {
          "type": "object",
          "description": "Expected input structure for this agent"
        },
        "output_schema": {
          "type": "object",
          "description": "Expected output structure from this agent"
        },
        "is_master": {
          "type": "boolean",
          "default": false,
          "description": "Whether this is a master/coordinator agent"
        }
      }
    },
    "Tool": {
      "type": "object",
      "required": ["name", "type"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Unique tool identifier"
        },
        "type": {
          "type": "string",
          "enum": ["database", "api", "calculator", "email", "search", "file", "custom"],
          "description": "Tool type category"
        },
        "description": {
          "type": "string",
          "description": "What this tool does"
        },
        "config": {
          "type": "object",
          "description": "Tool-specific configuration",
          "additionalProperties": true
        },
        "auth_required": {
          "type": "boolean",
          "default": false,
          "description": "Whether this tool requires authentication"
        },
        "parameters": {
          "type": "object",
          "description": "Tool parameter schema",
          "additionalProperties": true
        }
      }
    },
    "Workflow": {
      "type": "object",
      "required": ["name", "description", "steps", "communication_pattern"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Unique workflow identifier"
        },
        "description": {
          "type": "string",
          "description": "What this workflow accomplishes"
        },
        "trigger": {
          "type": "string",
          "description": "How this workflow is initiated",
          "enum": ["manual", "scheduled", "event", "webhook"]
        },
        "steps": {
          "type": "array",
          "description": "Ordered list of workflow steps",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/WorkflowStep"
          }
        },
        "communication_pattern": {
          "type": "string",
          "enum": ["sequential", "parallel", "conditional", "graph"],
          "description": "How steps are executed"
        }
      }
    },
    "WorkflowStep": {
      "type": "object",
      "required": ["agent_id", "action"],
      "properties": {
        "agent_id": {
          "type": "string",
          "description": "ID of the agent executing this step"
        },
        "action": {
          "type": "string",
          "description": "Action to perform"
        },
        "inputs": {
          "type": "object",
          "description": "Input data for this step",
          "additionalProperties": true
        },
        "condition": {
          "type": "string",
          "description": "Optional condition for conditional execution"
        },
        "parallel_with": {
          "type": "array",
          "description": "Step IDs to execute in parallel with this step",
          "items": {
            "type": "string"
          }
        }
      }
    }
  }
}
