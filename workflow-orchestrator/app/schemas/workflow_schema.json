{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "WorkflowDefinition",
  "description": "Workflow definition schema - defines execution flow of agent steps",
  "type": "object",
  "required": ["name", "description", "steps", "communication_pattern"],
  "properties": {
    "name": {
      "type": "string",
      "description": "Unique workflow identifier",
      "pattern": "^[a-z][a-z0-9_]*$",
      "minLength": 3,
      "maxLength": 100
    },
    "description": {
      "type": "string",
      "description": "What this workflow accomplishes",
      "minLength": 10,
      "maxLength": 500
    },
    "trigger": {
      "type": "string",
      "description": "How this workflow is initiated",
      "enum": ["manual", "scheduled", "event", "webhook"],
      "default": "manual"
    },
    "steps": {
      "type": "array",
      "description": "Ordered list of workflow steps",
      "minItems": 1,
      "maxItems": 100,
      "items": {
        "$ref": "#/definitions/WorkflowStep"
      }
    },
    "communication_pattern": {
      "type": "string",
      "enum": ["sequential", "parallel", "conditional", "graph"],
      "description": "How steps are executed"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "state": {
          "type": "string",
          "enum": ["draft", "temp", "final", "archived"],
          "description": "Workflow lifecycle state"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+$",
          "description": "Version number (e.g., 1.0, 2.0)"
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time"
        }
      }
    }
  },
  "definitions": {
    "WorkflowStep": {
      "type": "object",
      "required": ["agent_id", "action"],
      "properties": {
        "agent_id": {
          "type": "string",
          "description": "ID of the agent executing this step",
          "pattern": "^[a-z][a-z0-9_]*$"
        },
        "action": {
          "type": "string",
          "description": "Action to perform",
          "minLength": 3,
          "maxLength": 100
        },
        "inputs": {
          "type": "object",
          "description": "Input data for this step",
          "additionalProperties": true
        },
        "outputs": {
          "type": "object",
          "description": "Expected output structure",
          "additionalProperties": true
        },
        "condition": {
          "type": "string",
          "description": "Optional condition for conditional execution"
        },
        "parallel_with": {
          "type": "array",
          "description": "Agent IDs to execute in parallel with this step",
          "items": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9_]*$"
          }
        },
        "retry_policy": {
          "type": "object",
          "properties": {
            "max_attempts": {
              "type": "integer",
              "minimum": 1,
              "maximum": 5,
              "default": 3
            },
            "timeout_seconds": {
              "type": "integer",
              "minimum": 1,
              "maximum": 3600,
              "default": 300
            }
          }
        }
      }
    }
  }
}
